# Android App Signing Guide

This guide explains how to configure proper signing keys for your Flutter app for production releases.

## Why Signing Keys Matter

### Security Benefits:
- âœ… **App integrity** - Ensures the app hasn't been tampered with
- âœ… **Update verification** - Only signed updates can be installed
- âœ… **Store requirement** - Required for Google Play Store
- âœ… **User trust** - Users know the app is authentic

### Signing Types:

1. **Debug Signing** (Current configuration)
   - Used for development and testing
   - Automatically generated by Android Studio
   - Not suitable for production

2. **Release Signing** (What we'll configure)
   - Used for production releases
   - Must be kept secure and backed up
   - Required for app store distribution

## Step 1: Generate Release Keystore

### Using Android Studio (Recommended):

1. **Open Android Studio**
2. **Go to**: Build â†’ Generate Signed Bundle/APK
3. **Select**: APK
4. **Click**: Create new keystore
5. **Fill in the details**:
   ```
   Key store path: /path/to/your/release-key.jks
   Password: [create a strong password]
   Alias: [create an alias, e.g., "release-key"]
   Password: [create a strong password for the key]
   Validity: 25 years (recommended)
   Certificate: Fill in your details
   ```

### Using Command Line:

```bash
keytool -genkey -v -keystore release-key.jks -keyalg RSA -keysize 2048 -validity 10000 -alias release-key
```

## Step 2: Configure Signing in build.gradle.kts

### Create keystore.properties file:

Create `android/keystore.properties`:
```properties
storePassword=your_keystore_password
keyPassword=your_key_password
keyAlias=release-key
storeFile=../release-key.jks
```

### Update build.gradle.kts:

```kotlin
android {
    // ... existing configuration ...
    
    signingConfigs {
        create("release") {
            val keystoreProperties = Properties()
            val keystorePropertiesFile = rootProject.file("keystore.properties")
            if (keystorePropertiesFile.exists()) {
                keystoreProperties.load(FileInputStream(keystorePropertiesFile))
            }
            
            keyAlias = keystoreProperties["keyAlias"] as String?
            keyPassword = keystoreProperties["keyPassword"] as String?
            storeFile = keystoreProperties["storeFile"]?.let { file(it) }
            storePassword = keystoreProperties["storePassword"] as String?
        }
    }
    
    buildTypes {
        release {
            signingConfig = signingConfigs.getByName("release")
            isMinifyEnabled = true
            isShrinkResources = true
            proguardFiles(
                getDefaultProguardFile("proguard-android-optimize.txt"),
                "proguard-rules.pro"
            )
        }
    }
}
```

## Step 3: Protect Your Keystore

### File Structure:
```
your-project/
â”œâ”€â”€ android/
â”‚   â”œâ”€â”€ keystore.properties    # Keystore configuration
â”‚   â””â”€â”€ app/
â”‚       â””â”€â”€ build.gradle.kts   # Build configuration
â”œâ”€â”€ release-key.jks           # Your keystore file
â””â”€â”€ .gitignore               # Add keystore files here
```

### Update .gitignore:
```gitignore
# Keystore files
*.jks
*.keystore
android/keystore.properties
```

## Step 4: GitHub Actions Integration

### For Automated Releases:

1. **Add keystore as GitHub Secret**:
   - Go to your GitHub repository
   - Settings â†’ Secrets and variables â†’ Actions
   - Add the following secrets:
     - `KEYSTORE_FILE` (keystore encoded in base64)
     - `KEYSTORE_PASSWORD`
     - `KEY_ALIAS`
     - `KEY_PASSWORD`

2. **Update GitHub Actions workflow**:
   ```yaml
   - name: Setup signing
     run: |
       echo "${{ secrets.KEYSTORE_FILE }}" | base64 -d > android/app/release-key.jks
       echo "storePassword=${{ secrets.KEYSTORE_PASSWORD }}" > android/keystore.properties
       echo "keyPassword=${{ secrets.KEY_PASSWORD }}" >> android/keystore.properties
       echo "keyAlias=${{ secrets.KEY_ALIAS }}" >> android/keystore.properties
       echo "storeFile=release-key.jks" >> android/keystore.properties
   ```

## Step 5: Build Commands

### Local Release Build:
```bash
flutter build apk --release
```

### GitHub Actions:
The automated workflow will automatically use the release keystore.

## Step 6: Get Release SHA-1

### From Keystore:
```bash
keytool -list -v -keystore release-key.jks -alias release-key
```

### From APK:
```bash
keytool -printcert -jarfile app-release.apk
```

## Security Best Practices

### 1. Keystore Security:
- ğŸ”’ **Keep keystore secure** - Store in secure location
- ğŸ’¾ **Keystore backup** - Multiple secure backups
- ğŸ”‘ **Strong passwords** - Use complex passwords
- ğŸš« **Never commit** - Keep out of version control

### 2. Password Management:
- ğŸ” **Use password manager** - Store passwords securely
- ğŸ“ **Document everything** - Keep records of all details
- ğŸ”„ **Regular rotation** - Consider rotating keys periodically

### 3. Team Access:
- ğŸ‘¥ **Limited access** - Only trusted team members
- ğŸ“‹ **Access logs** - Track who has access
- ğŸ” **Secure sharing** - Use secure channels to share

## Troubleshooting

### Common Issues:

1. **"Keystore file not found"**:
   - Check file path in keystore.properties
   - Make sure the keystore file exists

2. **"Invalid keystore format"**:
   - Regenerate keystore with proper format
   - Check keystore file integrity

3. **"Incorrect password"**:
   - Check passwords in keystore.properties
   - Check for typos or encoding issues

### Verification Commands:

```bash
# Check keystore
keytool -list -v -keystore release-key.jks

# Check APK signature
jarsigner -verify -verbose -certs app-release.apk

# Get APK SHA-1
keytool -printcert -jarfile app-release.apk
```

## Migration from Debug to Release

### Current State:
- Using debug keystore for releases
- Not suitable for production

### Target State:
- Using release keystore for all releases
- Proper signing for store distribution

### Migration Steps:
1. Generate release keystore
2. Configure build.gradle.kts
3. Update GitHub Actions
4. Test with new signature
5. Update SHA-1 in Firebase

## Next Steps

1. **Generate your release keystore**
2. **Configure build.gradle.kts** with signing
3. **Update GitHub Actions workflow**
4. **Test the signing process**
5. **Update Firebase** with new SHA-1
6. **Deploy to production** with proper signing

## Important Notes

- âš ï¸ **Never lose your keystore** - You cannot update your app without it
- ğŸ”„ **Keep backups** - Multiple secure locations
- ğŸ“± **Test thoroughly** - Make sure signing works correctly
- ğŸ” **Secure storage** - Use encrypted storage for keystore

## Firebase Configuration

### Update SHA-1:
After generating the release keystore, you'll need to update the SHA-1 in Firebase:

1. **Get SHA-1 from release keystore**:
   ```bash
   keytool -list -v -keystore release-key.jks -alias release-key
   ```

2. **Add to Firebase Console**:
   - Go to Firebase Console â†’ Project Settings
   - Select your Android app
   - Add the new SHA-1 in the "SHA certificate fingerprints" section

3. **Download updated google-services.json**:
   - Firebase will generate a new google-services.json
   - Replace the existing file

## Advanced Troubleshooting

### Signing Issues:

1. **"Signature not valid"**:
   - Check if keystore is correct
   - Confirm if passwords are correct

2. **"APK cannot be installed"**:
   - Check if APK was signed correctly
   - Test on clean device

3. **"Verification error"**:
   - Use `jarsigner -verify` to check signature
   - Check if APK wasn't corrupted
